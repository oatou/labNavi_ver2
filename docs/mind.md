実験手順ガイドアプリケーション 仕様書 (Spec v1.0)
1. プロジェクト概要 & コンセプト
1.1 目的
富山高専専攻科の研究室における複雑な実験フロー（試験片準備〜データ解析）を、ミスなく安全に遂行するためのナビゲーションシステム。紙のマニュアルや口伝に依存せず、**「次に何をすべきか」「何に注意すべきか」**をシステムが提示することで、人為的ミス（ポカヨケ）と手戻りを防止する。

1.2 コアコンセプト
Local First & Offline: 外部ネット接続不要。ブラウザ（Chrome/Edge）単体で動作するSPA（Single Page Application）。

State Persistence: ブラウザを閉じても進捗が失われないよう、Local Storage等を活用して状態を保持する。

Focus & Safety: 全体像（フロー）と現在地（詳細）を分離表示し、危険な工程（ティーチング解除忘れ等）には明示的な確認アクション（チェックボックス）を強制する。

2. 機能要件定義 (Functional Requirements)
2.1 フローナビゲーション機能
全体フロー表示: 実験工程全体（Node）とその接続（Edge）を可視化する。

ステップ進行制御: 現在の工程が完了しない限り、次の工程へ進めないロック機能。

条件分岐ハンドリング: 「試験片の有無」によるループ（Step 1へ戻る or Step 2へ戻る）をユーザー選択で制御する機能。

2.2 詳細ガイド機能 (Detail Panel)
階層的表示: 親工程（例：1. 試験片準備）配下のサブタスク（例：1.1, 1.2）をリスト表示。

属性別表示: 指示内容は以下のタイプに分類してデザインを分ける。

Action: 通常の操作手順。

Warning/Danger: 安全に関わる重要事項（赤枠・アイコン強調）。

Check: ユーザーが物理的にチェックを入れる必要がある項目（進行ブロック条件）。

Input: 記録すべき数値（重量、座標など）の入力欄（※v1では入力値の一時保存のみでDB連携はなし）。

Formula: 計算式（塗布量計算、ファイル命名規則）の表示。

2.3 ユーティリティ機能
進捗リセット: 実験終了後、または中断後に初期状態に戻す機能。

ダークモード対応: 実験室の照明環境に合わせたUI切り替え（任意）。

3. データモデル設計
本アプリの核となるデータ構造です。静的な「フロー定義」と、動的な「ユーザー進捗」を分離して管理します。

3.1 データ構造定義 (TypeScript Interfaces)
TypeScript

/**
 * コンテンツの種類を定義
 * - text: 通常の説明
 * - warning: 注意事項（黄色/赤色表示）
 * - check: 完了チェックボックス（Nextボタンの活性化条件）
 * - input: 値の記録（保存用）
 * - formula: 計算式や命名規則の提示
 */
export type ContentType = 'text' | 'warning' | 'check' | 'input' | 'formula';

export interface StepContent {
  id: string;
  type: ContentType;
  text: string;           // 表示テキスト
  detail?: string;        // 補足説明（アコーディオン等で表示）
  required: boolean;      // trueの場合、この項目の完了/確認がないと次へ進めない
  placeholder?: string;   // inputタイプの場合のプレースホルダー
}

export interface SubProcess {
  id: string;             // 例: "1.1"
  title: string;          // 例: "試験片購入"
  contents: StepContent[];
}

export interface WorkflowNode {
  id: string;             // 例: "step-1"
  title: string;          // 例: "1. 試験片準備"
  type: 'process' | 'decision'; // 通常工程か、分岐点か
  subProcesses: SubProcess[];
  
  // 分岐ノード用（type='decision'の場合に使用）
  decisionOptions?: {
    label: string;
    targetNodeId: string;
  }[];
}

export interface WorkflowEdge {
  id: string;
  source: string;
  target: string;
}

export interface WorkflowDefinition {
  nodes: WorkflowNode[];
  edges: WorkflowEdge[];
}

/**
 * ユーザーの進捗状態管理用
 */
export interface UserProgress {
  currentNodeId: string;        // 現在アクティブなノード
  completedStepIds: string[];   // 完了したSubProcessのIDリスト
  checkedContentIds: string[];  // チェック済みのContentのIDリスト
  inputValues: Record<string, string>; // inputタイプで入力された値 { contentId: value }
}
3.2 ワークフロー定義データ (JSON Schema Example)
提供されたテキストに基づくデータ定義の実装イメージです。条件分岐ロジックを含みます。

TypeScript

// data/workflow.ts

export const experimentalWorkflow: WorkflowDefinition = {
  nodes: [
    {
      id: "step-1",
      title: "1. 試験片準備",
      type: "process",
      subProcesses: [
        {
          id: "1.1",
          title: "試験片購入",
          contents: [
            { id: "c-1-1-1", type: "text", text: "在庫確認後、先生に発注依頼。", required: false }
          ]
        },
        {
          id: "1.2",
          title: "試験片加工・測定",
          contents: [
            { id: "c-1-2-1", type: "text", text: "茶木さんにワイヤーカット依頼。多軸加工機で溝加工。", required: false },
            { id: "c-1-2-2", type: "check", text: "粗さ測定 (ymin 200±5μm) の確認", required: true },
            { id: "c-1-2-3", type: "warning", text: "[注意] 前日から温度平衡させる。", required: true }
          ]
        }
      ]
    },
    // ... (Step 2 ~ Step 6 は同様に定義) ...
    {
      id: "step-7",
      title: "7. データ解析",
      type: "process",
      subProcesses: [
        {
            id: "7.2",
            title: "解析ソフト操作",
            contents: [
                { id: "c-7-2-1", type: "text", text: "真円度解析・表面粗さ解析を実行", required: false },
                { id: "c-7-2-2", type: "input", text: "解析結果データの保存確認", placeholder: "ファイル名を入力", required: true }
            ]
        }
      ]
    },
    {
      id: "decision-loop",
      title: "次回の実験判断",
      type: "decision",
      subProcesses: [
        {
            id: "loop-check",
            title: "試験片在庫の確認",
            contents: [
                { id: "c-loop-1", type: "text", text: "実験終了後、次回の実験のために試験片の有無を確認してください。", required: false }
            ]
        }
      ],
      decisionOptions: [
        { label: "試験片がない (発注が必要)", targetNodeId: "step-1" },
        { label: "試験片がある (準備へ)", targetNodeId: "step-2" }
      ]
    }
  ],
  edges: [
    { id: "e1-2", source: "step-1", target: "step-2" },
    { id: "e2-3", source: "step-2", target: "step-3" },
    { id: "e3-4", source: "step-3", target: "step-4" },
    { id: "e4-5", source: "step-4", target: "step-5" },
    { id: "e5-6", source: "step-5", target: "step-6" },
    { id: "e6-7", source: "step-6", target: "step-7" },
    { id: "e7-d", source: "step-7", target: "decision-loop" },
    // ループ用のエッジは動的に処理、または可視化用として定義
    { id: "ed-1", source: "decision-loop", target: "step-1" }, 
    { id: "ed-2", source: "decision-loop", target: "step-2" }
  ]
};
4. UI/UXデザイン仕様
画面は左右分割の2カラムレイアウト（PC/タブレット横向き推奨）を採用します。

4.1 画面レイアウト
左パネル (Navigation / Flow View): 幅 30-40%

役割: 全体工程の可視化。

コンポーネント: フローチャート（React Flow等を使用）。

挙動:

完了したノードは「緑色」に変化。

現在のノードは「青色」＋「発光エフェクト」で強調。

未到達のノードは「グレーアウト」。

ノードクリックで右パネルの詳細を切り替え可能（ただし、未来の工程の操作は不可）。

右パネル (Action / Detail View): 幅 60-70%

役割: 具体的な作業指示と操作。

ヘッダー: 現在のStepタイトル（例: "3. 実験装置のセットアップ"）。

メインエリア: SubProcessごとのカード型リスト。

各行にチェックボックス、入力フォーム、警告アイコンを配置。

[重要] 3.3「ステージティーチング」のチェックボックス解除などは、赤色の太字＋チェックボックスで実装し、チェックしないと「次へ」ボタンが押せない仕様とする。

フッター:

「＜ 戻る」ボタン。

「次へ ＞」ボタン（現在のStep内のrequired項目が全て埋まるまでDisable状態）。

decisionノードの場合は、ボタンが分岐選択肢（例：「試験片なし(Step1へ)」「試験片あり(Step2へ)」）に変化する。

4.2 インタラクション詳細
Safety Check Interaction:

type: 'warning' かつ required: true の項目（例: ティーチングのチェック外し忘れ防止）は、ユーザーが能動的にチェックボックスをクリックした際、一瞬確認ダイアログまたはトーストを表示し「本当に確認しましたか？」と念押ししてもよい。

Naming Convention Helper:

Step 6.3「データ保存」において、命名規則 δ-n-V-t の入力補助ツールを表示する。

UI: 隙間、回転数、電圧、時間を入力する4つのミニTextboxを表示し、自動結合してクリップボードにコピーできるボタンを配置する。

#　詳細作業
### 1. 試験片準備



* 1.1 試験片購入: 在庫確認後、先生に発注依頼。



* 1.2 試験片加工: 茶木さんにワイヤーカット依頼 -> 多軸加工機で溝加工 -> 粗さ測定(ymin 200±5μm)。



* 1.3 試験片測定: 形状測定器(x=0基準, 溝中央)、粗さ測定器(溝内3箇所)。データはUSB経由でサーバーへ。[注意]測定方法は年により異なるため要確認。[注意]前日から温度平衡させる。







### 2. ワークの準備



* 2.1 洗浄と初期重量測定: 超音波洗浄 -> エアブロー乾燥 -> 重量測定(3回) -> Excel入力 -> バックアップ保存。







### 3. 実験装置のセットアップ



* 3.1 機器起動: モーター、モニター、PC、トルク計、タイマー等の電源ON。(電場印加時は電源装置も)



* 3.2 ワーク設置・ゼロ点合わせ: 治具固定 -> 通電テスター接続 -> Z軸調整でゼロ点特定 -> 座標記録。



* 3.3 ステージティーチング: -10.00mm移動設定 -> [重要]チェックボックス解除(指差確認) -> 電流計配線。







### 4. 流体の塗布



* 4.1 準備: スポイト加工 -> 総重量測定 -> 塗布量計算。



* 4.2 塗布・均し: 200rpm回転 -> 塗布(誤差±0.3g) -> ステージ操作で流体を均す -> 高さ合わせ -> トルク計ゼロ点。







### 5. 研磨工程



* 5.1 実行: 台移動ON -> モニター記録開始 -> ストップウォッチ/モーター開始 -> (電場印加開始)。



* 5.2 異常時対応: 停止時は時間記録して中断。電流不安定時も中断。データ保存。







### 6. 後片付けとデータ保存



* 6.1 終了処置: 回転停止 -> 記録終了 -> 電源OFF -> ワーク取り外し。



* 6.2 事後測定: 洗浄(6分) -> 乾燥 -> 重量測定(3回) -> 入力。



* 6.3 データ保存: 命名規則(δ-n-V-t)に従い保存。



* 6.4 終了: 清掃 -> 電源OFF -> 試験片保管(翌日の測定用)。







### 7. データ解析



* 7.1 実験後測定: 2次元測定。



* 7.2 解析ソフト操作: ファイル選択 -> データ閲覧 -> 真円度解析 -> 表面粗さ解析(範囲指定) -> グラフ設定(軸ラベル等) -> 保存。







### Loop Condition



* 実験終了後、次が必要な場合:



    * 試験片がない場合 -> 1 (試験片準備) へ戻る



    * 試験片がある場合 -> 2 (ワーク準備) へ戻る







# Output Format



- 成果物は、`App.tsx`, `components/Flowchart.tsx`, `components/DetailPanel.tsx`, `data/workflow.ts` などのファイル構造で提示し、コピペで動作するように実装してください。



- まずはプロジェクトの構成案と、中心となるデータ構造（JSON）の定義から提示してください。











## 細かい内容



### 1. 試験片準備



- **1.1 試験片購入



- 少なくなっていたら先生に聞いて発注する。



- **1.2 試験片加工



- 購入した板または元々購入しておいた板を茶木さんにお願いしてワイヤーカットをしてもらう



              -カットしてもらった平面の試験片を溝付き平面で実験する場合は多軸加工機で加工してもらう



              -その溝付き平面を溝に垂直な方向に粗さ測定をしてyminが200±5μmになるようにしてもらう



- **1.2 試験片測定



              -形状測定器による測定点: 溝に直角な方向をx=0 mmの基準とし、それに加えて真ん中の溝の中のみを測定する。



               - 粗さ測定器による測定点: 溝内を真ん中、右、左の3箇所で測定する。



              -測定後測定した内容をUSBに入れてデータサーバーに移動しておく



              -[注意]その年によって図る個所や方法が違うので先生や先輩に確認する



              -[注意]事前に(可能なら前日より前)測定室に試験片を保管して温度を平衡にしておく



2. ワークの準備



2.1 洗浄と初期重量測定







[行動] 選定したワークを超音波洗浄機にて洗浄する。







[行動] 洗浄後、コンプレッサーのエアブローを用いて、付着している灯油等の溶剤を完全に吹き飛ばす。







[行動] 電子天秤を用いてワークの重量を3回測定する。







[行動] 測定値をPC内のExcelファイル「No.N 実験記録表」へ入力する。







[行動] 入力後、Excelファイルを「名前を付けて保存」し、データのバックアップを確保する。



3. 実験装置のセットアップ



3.1 機器の起動







[行動] 以下の機器の電源をONにする。







モーター







記録用モニター







ステージ制御用PC







トルク計







ステージ制御用タイマー（2台とも）











[行動] （電場印加時のみ）電源装置とアンプの電源を入れ、所定の電場強度に調整しておく。



3.2 ワークの設置とゼロ点合わせ







[行動] 適切な治具を用いて、ワークを実験装置に湯部で押して動かないくらいの力になるように固定する。







[行動] 通電確認用のテスターを用意し、プローブを接続する。







[行動] Z軸を徐々に下げ、ワークと工具が接触して通電する（テスターが反応する）位置を「ゼロ点」として特定する。







[注意点] ゼロ点の精度は概算で問題ない。装置右側を使用すると視認しやすく、調整が容易である。







[行動] 特定したZ座標を実験記録用紙に記入する。







[行動] ステージを一旦下降させ、ワークを工具から離す。



3.3 ステージのティーチング設定







[行動] ステージ制御用PCの「ティーチング」機能を使用し、ステージを



-10.00{mm} 移動させる設定を行う。







[行動] 移動完了後、必ず「ティーチング」のチェックボックスを外す。







[注意点] チェックを外し忘れると意図しない動作の原因となり危険であるため、指差し確認を行うこと。







[行動] （電場印加時のみ）電流値確認用テスターに配線を接続する。



4. 流体の塗布



4.1 塗布準備







[行動] スポイトの先端をハサミで斜めにカットし、塗布しやすい形状にする。







[行動] 流体入りの瓶にスポイトを入れた状態で、総重量を測定する。







[行動] 実験記録表の記述に従い、必要な流体塗布量を計算し、目標重量を設定する。



4.2 流体塗布と均し作業







[行動] 工具を 200{rpm}



程度で回転させる。







[行動] 回転中の工具に流体を塗布する。







[行動] 流体の塗布重量が目標値になるよう調整する。







[注意点] 重量の許容誤差は ± 0.3{g} とする。範囲を超えた場合は再調整を行うこと。







[行動] 工具を回転させたままステージを少し上昇させ、流体中央に筋が入る程度まで均（なら）してから、ステージを下げる。







[行動] 工具の回転を停止させ、正規の実験高さにステージを合わせる。







[行動] トルク計のゼロ点合わせを行う。



5. 研磨工程



5.1 実験の実行







[行動] 台移動スイッチを入れ、10秒前(20秒)にモニター(HIOKI)の記録を始めて30秒に合わせてストップウォッチ開始およびモーターを回転させる。







[行動] （電場印加時のみ）このタイミングで電場印加を開始する。



5.2 異常時の対応







[行動] 実験中に回転が停止した場合、その時点のタイマー時間および気づいた点を実験記録表にメモする。







[注意点] 回転停止時は実験を中断扱いとする。記録中のデータを保存し、後日解析を行う。







[注意点] 電流が安定しない場合は実験を中断して記録中のデータを保存し、後日解析を行う。



6. 後片付けとデータ保存



6.1 実験終了処置







[行動] 工具の回転を止め、モニター記録を終了する。







[行動] （電場印加時のみ）アンプの電源を切り、安全を確認する。







[行動] ステージを下降させ、ワークを取り外す。



6.2 洗浄と事後測定







[行動] ワークを超音波洗浄機に入れ、6分間洗浄する。







[注意点] 加工面を下向きにして入れることで、汚れの除去効率が高まる。







[行動] 洗浄終了後、コンプレッサーで溶剤等を吹き飛ばし乾燥させる。







[行動] 電子天秤でワーク重量を3回測定し、結果を実験記録表に入力する。



6.3 データ保存







[行動] 記録用モニターの「保存」ボタンを押し、実験ログを保存する。







[注意点] 記録システムの文字数制限（仕様上の制約）に対応するため、ファイル名は以下の命名規則に従うこと。







規則：



δ - n - V - t （隙間 - 回転数 - 電圧 - 時間）







例：



δ=0.7{mm}, n=600{rpm}, V=400 {V}, t=20 {min}$ の場合







 7-6-4-2



6.4 清掃・終了確認







[行動] 工具に残った流体を清掃する。







[行動] その日の実験をすべて終了する場合は、全装置の電源をOFFにする。







[行動]次の日以降２次元測定ができるように測定室に実験を行った試験片を保管しておく



7データ解析



7.1実験後の測定







[行動] 実験前と同様に試験片の２次元測定を行う



7.2データ解析



7.2.1ファイル選択



- 📂 **ファイル選択**ボタンをクリック



- .tx1 または .NC ファイルを選択



- 自動的にデータが読み込まれ、「データ」タブに表示されます



 



7.2.2. データの閲覧・編集



- **📊 データ**タブを開く



- 元データと補正後データを表形式で確認



- **🔄 更新**：データを再読み込み



- **💾 CSV保存**：データをCSVファイルとして保存



 



7.2.3. 真円度解析



- **🔍 真円度解析**ボタンをクリック



- 真円度、Ra（表面粗さ）、半径などが計算されます



- 解析結果がテキストとグラフで表示されます



- グラフは自動的に保存されます



 



7.2.4. 表面粗さ解析（範囲指定可能）



- **🎨 グラフ設定**タブを開く



- **表面粗さ解析範囲**セクションで範囲を指定



  - 例：15 ≦ x ≦ 20



  - 空欄の場合は全範囲



- **📊 表面粗さ解析**ボタンをクリック



- 指定範囲の平均高さからRaが計算されます



 



7.2.5. グラフのカスタマイズ



**🎨 グラフ設定**タブで以下を設定できます：



 



#### タイトル設定



- グラフタイトルを入力



- タイトル位置：top（上）または bottom（下）



 



#### 軸ラベル設定



- **X軸ラベル**：



  - y-axis position [mm]（デフォルト）



  - x-axis position [mm]



  - その他（自由記述）



- **Y軸ラベル**：



  - Profile curve [μm]（デフォルト）



 



#### 表示範囲設定



- X軸範囲：最小値 ≦ x ≦ 最大値



- Y軸範囲：最小値 ≦ y ≦ 最大値



- 空欄の場合は自動調整



- **範囲をリセット**ボタンで全てクリア



 



#### 凡例設定



- 凡例を表示：チェックボックスでON/OFF



 



#### 設定の適用



- **✅ 設定を適用してグラフ更新**ボタンをクリック



- 次回のグラフ保存時に設定が反映されます



 



### 6. グラフ保存（真円度解析なし）



- データを読み込んだ後、真円度解析せずにグラフを保存可能



- **💾 グラフ保存**ボタンをクリック



- PNG または PDF 形式で保存



- カスタマイズした設定が反映されます



以上の機能を使って必要な情報をまとめる



このあと実験が必要になって



              試験片がない場合:1に戻る



              試験片がある場合:2に戻る